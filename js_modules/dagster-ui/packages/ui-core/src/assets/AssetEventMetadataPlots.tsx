import {Box, ExternalAnchorButton, NonIdealState, SpinnerWithText} from '@dagster-io/ui-components';

import {AssetMaterializationGraphs} from './AssetMaterializationGraphs';
import {useGroupedEvents} from './groupByPartition';
import {AssetKey, AssetViewParams} from './types';
import {useRecentAssetEvents} from './useRecentAssetEvents';

interface Props {
  assetKey?: AssetKey;
  params: AssetViewParams;
  assetHasDefinedPartitions: boolean;
}

export const AssetEventMetadataPlots = (props: Props) => {
  const {assetKey, params, assetHasDefinedPartitions} = props;
  const {materializations, observations, loadedPartitionKeys, loading, xAxis} =
    useRecentAssetEvents(assetKey, params, {assetHasDefinedPartitions});

  const grouped = useGroupedEvents(xAxis, materializations, observations, loadedPartitionKeys);

  if (loading) {
    return (
      <Box padding={{vertical: 24}} flex={{direction: 'row', justifyContent: 'center'}}>
        <SpinnerWithText label="Loading plotsâ€¦" />
      </Box>
    );
  }

  return (
    <AssetMaterializationGraphs
      xAxis={xAxis}
      groups={grouped}
      emptyState={
        <Box padding={{horizontal: 24, vertical: 64}}>
          <NonIdealState
            shrinkable
            icon="asset_plot"
            title="Asset plots are automatically generated by metadata"
            description="Include numeric metadata entries in your materializations and observations to see data graphed by time or partition."
            action={
              <ExternalAnchorButton href="https://docs.dagster.io/concepts/metadata-tags/asset-metadata">
                View documentation
              </ExternalAnchorButton>
            }
          />
        </Box>
      }
    />
  );
};
